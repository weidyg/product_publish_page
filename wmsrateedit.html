<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title></title>
</head>

<body>
  <div id="wmsrateedit"></div>
  <script src="/assets/js/post.js"> </script>
  <script>

    const baseUrl = 'http://localhost:49050/api/services/app/RateConfig/';
    const productEditUrls = {
      loadData: baseUrl + "GetPolicyById",
      createPolicy: baseUrl + "CreatePolicy",
      updatePolicy: baseUrl + "UpdatePolicy",
    }

    function convertRateConfigType(calculateRule, expenseType) {
      const isFixedFee = calculateRule == 10;
      const isIntervalFee = (calculateRule >= 0 && calculateRule != 10);

      const isStorageFee = expenseType == 20;
      const isPiecesFee = expenseType == 40 || expenseType == 50;
      const units = {
        10: isStorageFee ? '天' : isPiecesFee ? '件' : '单',//天
        20: isStorageFee ? '件/天' : '件',//件/天
        30: 'kg',
        40: '立方',
      }
      const precisions = { 10: 0, 20: 0, 30: 3, 40: 3, }
      const unit = units[calculateRule];
      const precision = precisions[calculateRule] || 0;
      // console.log('convertRateConfigType', isFixedFee, isIntervalFee, precision, isStorageFee);
      return { isFixedFee, isIntervalFee, unit, precision, isStorageFee }
    }

    const options = {
      stores: [
        { label: '奇门正式测试', value: 1471 },
        { label: '青创网A099仓', value: 1545 },
        { label: '青创网A100仓', value: 1659 },
      ],
      operateTypes: [
        { label: '销售出库', value: 10 },
        { label: '采购退出库', value: 20 },
        { label: '销售退货入库', value: 30 },
        { label: '采购退入库', value: 40 },
      ],
      expenseTypes: [
        { label: '操作费', value: 10 },
        { label: '商品储存费', value: 20 },
        { label: '订单快递费', value: 30 },
        { label: '物料使用费', value: 40 },
        { label: '增值服务费', value: 50 },
      ],
      calculateRules: [
        { label: '固定费用', value: 10 },
        { label: '数量区间', value: 20 },
        { label: '重量区间', value: 30 },
        { label: '体积区间', value: 40 },
      ],
    }
    function getRateConfigOptions() {
      return new Promise((resolve, reject) => {
        setTimeout(() => {
          resolve(options);
        }, 2000);
      })
    }

    function loadRateConfigPolicy(id) {
      id = id || getQueryString('id');
      if (id > 0) {
        var input = { id: id, includeDetails: true }
        return post(productEditUrls.loadData, input);
      }
      return Promise.resolve({});
    }

    function saveRateConfigPolicy(value) {
      var url = value.id > 0
        ? productEditUrls.updatePolicy
        : productEditUrls.createPolicy;
      value.includeDetails = true;
      return post(url, value);
    }

    function cancelRateConfigPolicy() {
      // window.history.back();
    }

    // function convertRateConfigType(calculateRule, expenseType) {
    //   const isFixedFee = calculateRule == 10;
    //   const isIntervalFee = (calculateRule >= 0 && calculateRule != 10);
    //   const isWeight = calculateRule == 30;
    //   const isStorageFee = expenseType == 20;
    //   console.log('convertRateConfigType', calculateRule, expenseType);
    //   console.log('convertRateConfigType', isFixedFee, isIntervalFee, isWeight, isStorageFee);
    //   return { isFixedFee, isIntervalFee, isWeight, isStorageFee }
    // }
  </script>
  <script type="module" src="/src/pages/wms/rateConfigPolicy/edit/main.tsx"></script>
</body>

</html>